# ğŸ§  workflow-rs é¡¹ç›®è¯´æ˜

`workflow-rs` æ˜¯ä¸€ä¸ªç”¨ Rust ç¼–å†™çš„é€šç”¨å·¥ä½œæµå¼•æ“ï¼Œèåˆäº†å›¾æ‰§è¡Œæ¨¡å‹ã€å¯æ‰©å±•èŠ‚ç‚¹ç³»ç»Ÿã€æ•°æ®ä¸Šä¸‹æ–‡ä¼ é€’ä¸å¤„ç†å™¨æœºåˆ¶ï¼Œç›®æ ‡æ˜¯æ„å»ºä¸€ä¸ªæ¸…æ™°ã€æ¨¡å—åŒ–ã€å¯è¿è¡Œçš„å·¥ä½œæµæ¡†æ¶ã€‚

---

## âœ¨ æ ¸å¿ƒè®¾è®¡ç†å¿µ

1. **èŒè´£æ¸…æ™°ï¼Œæ¨¡å—è§£è€¦ï¼š** å„æ¨¡å—å•ä¸€èŒè´£ï¼Œå½¼æ­¤é€šè¿‡æ¥å£åä½œã€‚
2. **å›¾é©±åŠ¨æ‰§è¡Œï¼š** æ•´ä½“æµç¨‹é€šè¿‡ DAGï¼ˆæœ‰å‘æ— ç¯å›¾ï¼‰æ§åˆ¶èŠ‚ç‚¹æ‰§è¡Œé¡ºåºã€‚
3. **èŠ‚ç‚¹å¯æ’æ‹”ï¼š** æ‰€æœ‰èŠ‚ç‚¹å®ç° `Executable` traitï¼Œå¯çµæ´»ç»„åˆä¸æ‰©å±•ã€‚
4. **æ•°æ®é©±åŠ¨æµè½¬ï¼š** èŠ‚ç‚¹æ‰§è¡Œä¾èµ–è¾“å…¥æ•°æ®ï¼Œç”±ä¸Šä¸‹æ¸¸èŠ‚ç‚¹ä¼ é€’ã€‚
5. **Processor æ’ä»¶æœºåˆ¶ï¼š** æ”¯æŒå¯¹èŠ‚ç‚¹è¾“å…¥è¾“å‡ºè¿›è¡Œé€šç”¨å¤„ç†ï¼ˆå¦‚æ—¥å¿—ã€æ ¡éªŒã€è½¬æ¢ç­‰ï¼‰ã€‚

---

## ğŸ—‚ï¸ ç›®å½•ç»“æ„

```bash
workflow-rs/
â”œâ”€â”€ graph/            # å›¾ç»“æ„ä¸ç¼–è¯‘é€»è¾‘
â”œâ”€â”€ model/            # æ•°æ®æ¨¡å‹ï¼ˆNode å®šä¹‰ã€Context ç­‰ï¼‰
â”œâ”€â”€ node/             # æ‰€æœ‰èŠ‚ç‚¹å®šä¹‰ä¸æ ¸å¿ƒ trait
â”‚   â”œâ”€â”€ task/         # æ‰§è¡Œå‹èŠ‚ç‚¹ï¼ˆå¦‚ PromptNodeï¼‰
â”‚   â””â”€â”€ orchestration/# æ§åˆ¶å‹èŠ‚ç‚¹ï¼ˆå¦‚ BranchNodeï¼‰
â”œâ”€â”€ processor/        # Processor æ’ä»¶æ¨¡å—ï¼ˆæ—¥å¿—ã€æ ¡éªŒç­‰ï¼‰
â”‚   â”œâ”€â”€ processors/   # å·²å®ç°çš„ processor ç±»å‹
â”‚   â”œâ”€â”€ traits.rs     # ProcessorTrait å®šä¹‰
â”‚   â”œâ”€â”€ registry.rs   # æ³¨å†Œä¸è·å– Processor çš„é€»è¾‘
â”‚   â””â”€â”€ mod.rs        # processor æ¨¡å—å…¥å£
â”œâ”€â”€ runner.rs         # å·¥ä½œæµæ‰§è¡Œå™¨ Runnerï¼Œæ§åˆ¶æ‰§è¡Œè°ƒåº¦
â”œâ”€â”€ workflow.rs       # å·¥ä½œæµå¯åŠ¨å°è£…å…¥å£
â””â”€â”€ example_workflow.rs # ç¤ºä¾‹è¿è¡Œä»£ç 
```

---

## ğŸ§± å„æ¨¡å—åŠŸèƒ½è¯´æ˜

### 1. `graph/`

ç”¨äºå®šä¹‰å·¥ä½œæµå›¾çš„ç»“æ„ï¼šåŒ…æ‹¬èŠ‚ç‚¹é›†åˆ (`node_data`)ã€è¾¹é›†åˆ (`edges`)ã€å‰åç»§æ˜ å°„ (`predecessors`, `successors`)ã€‚`compile()` æ–¹æ³•ç”¨äºæ„å»ºå›¾æ‹“æ‰‘ç»“æ„å¹¶æ£€æŸ¥ç¯ã€‚

### 2. `model/`

å®šä¹‰å„ç§è¿è¡Œæ—¶æ¨¡å‹ï¼š

- `Node`ï¼šç”¨äºæè¿°é™æ€é…ç½®ï¼ˆç±»å‹ã€å‚æ•°ï¼‰ã€‚
- `Context`ï¼šè¿è¡Œæ—¶ä¸Šä¸‹æ–‡ï¼ŒåŒ…å«æ‰€æœ‰èŠ‚ç‚¹å®ä¾‹å’Œå…±äº«æ•°æ®ï¼ˆå¦‚ metadataï¼‰ã€‚
- `NodeOutput`ï¼šç»Ÿä¸€çš„èŠ‚ç‚¹è¾“å‡ºåŒ…è£…ã€‚

### 3. `node/`

èŠ‚ç‚¹æ¨¡å—ï¼ŒåŒ…å«æ‰€æœ‰å¯æ‰§è¡ŒèŠ‚ç‚¹ç±»å‹ã€‚

- æ‰€æœ‰èŠ‚ç‚¹å®ç° `Executable` traitã€‚
- åˆ†ä¸ºä¸¤ç±»ï¼š

  - `task/`ï¼šæ‰§è¡Œå‹èŠ‚ç‚¹ï¼ˆå¦‚ PromptNodeï¼Œç”Ÿæˆå†…å®¹ï¼‰
  - `orchestration/`ï¼šæ§åˆ¶å‹èŠ‚ç‚¹ï¼ˆå¦‚ BranchNodeï¼Œç”¨äºæ¡ä»¶åˆ†æ”¯ï¼‰

### 4. `processor/`

ç”¨äºè¾“å…¥è¾“å‡ºå¤„ç†çš„æ’ä»¶æ¨¡å—ã€‚

- å®šä¹‰äº†é€šç”¨ `ProcessorTrait` æ¥å£ï¼ˆå¯æ‰©å±•ä¸ºå¼‚æ­¥ï¼‰ã€‚
- `ProcessorRegistry` æ”¯æŒåŠ¨æ€æ³¨å†Œä¸è·å–ã€‚
- å†…å«å¤šä¸ª `Processor` ç¤ºä¾‹ï¼Œå¦‚ LoggingProcessorã€ValidationProcessorã€‚

### 5. `runner.rs`

å·¥ä½œæµæ‰§è¡Œå™¨ï¼Œæ§åˆ¶èŠ‚ç‚¹è°ƒåº¦ï¼š

- ç®¡ç†é˜Ÿåˆ—ä¸å‰é©±èŠ‚ç‚¹çŠ¶æ€ã€‚
- æ”¯æŒè¾“å…¥æ•°æ®ç´¯ç§¯ä¸è¾“å‡ºä¼ é€’ã€‚
- è°ƒç”¨èŠ‚ç‚¹çš„ `execute()` æ–¹æ³•ä¾æ¬¡æ‰§è¡Œæ•´å¼ å›¾ã€‚

### 6. `workflow.rs`

å°è£…ç»Ÿä¸€å¯åŠ¨å…¥å£ï¼Œè°ƒç”¨é“¾è·¯ä¸ºï¼š

```
Graph -> compile() -> Context::from_graph -> Runner::run()
```

é€‚ç”¨äºä¸šåŠ¡æ–¹ç›´æ¥è°ƒç”¨ï¼Œæ— éœ€å…³å¿ƒåº•å±‚æ¨¡å—ç»„åˆã€‚

### 7. `example_workflow.rs`

å·¥ä½œæµä½¿ç”¨ç¤ºä¾‹ï¼š

- æ„å»ºèŠ‚ç‚¹ä¸å›¾ã€‚
- æ‰§è¡Œ `Workflow::start()` å¯åŠ¨è¿è¡Œã€‚
- ç”¨äºéªŒè¯å„æ¨¡å—æ˜¯å¦èƒ½ååŒè¿è¡Œã€‚

---

## âœ… å½“å‰è¿›å±•

- [x] Graph æ„å»ºä¸æ‹“æ‰‘æ’åº
- [x] Node ç»“æ„ä¸ Executable æ‰§è¡Œå°è£…
- [x] PromptNode / BranchNode å®ç°
- [x] Context æ„å»ºæœºåˆ¶
- [x] Runner æ§åˆ¶æ‰§è¡Œæµç¨‹
- [x] Workflow å¯åŠ¨å°è£…
- [x] Processor æ¨¡å—ç»“æ„æ­å»ºï¼ˆtraits + registryï¼‰

---

## ğŸš§ å¾…å¼€å‘åŠŸèƒ½

- [ ] ParallelNodeã€AggregatorNodeã€RepeatNode
- [ ] ProcessorTrait å¼‚æ­¥æ”¯æŒ
- [ ] Processor æ‰§è¡Œé¡ºåºé“¾è·¯
- [ ] èŠ‚ç‚¹çŠ¶æ€è·Ÿè¸ªï¼ˆRunning/Failedï¼‰
- [ ] Task å¼‚å¸¸æ•è·ä¸é‡è¯•æœºåˆ¶

---

## ğŸ“Œ ä½¿ç”¨è¯´æ˜

```rust
let graph = build_graph(); // æ„å»º Graph
let input = json!("Start");
Workflow::start(graph, input).await.unwrap();
```
